####
#	SCRIPTED EFFECTS for the Siege events. Colateral damage, enslavement, etc
#	This code uses heavily the scripted effect and "dynamic inputs", where you can add $xx$, and determine this in the event. 
#	In your event if you write, insteaf of a simple scripted effect ( collateral damage = yes) you use this: ( collateral = { hd = 20 } ) it will use this 20 inside the $hd$ field. This means that we can use the same effect below, but dependent on several % of 20, 40, 60, etc, withouth having to write one effect for each. 
#	If you have doubts or comments on that, contact us on Discord. Here's the wiki resources: https://eu4.paradoxwikis.com/Commands#Scripted_Effects 
####

define_sack_and_devastation = {
	set_variable = { which = sack_lost value = $sackvalue$ }		divide_variable = { which = sack_lost value = 100 }
	multiply_variable = { which = sack_lost which = loot_value } 	multiply_variable = { which = sack_lost which = sack_ratio }
	set_variable = { which = prov_devst value = $devst$ } 			multiply_variable = { which = prov_devst which = sack_ratio }
	set_variable = { which = col_value which = prov_devst }			divide_variable = { which = col_value value = 100 }
	multiply_variable = { which = col_value which = loot_value }
	
	# Show variables in the province modifier, to see what happened
	set_variable = { which = SS_looted_value which = sack_lost }	set_variable = { which = SS_devastation_done which = prov_devst }
	
}

enslave_effect = {
	# Send slaves to besieger
	set_variable = { which = SS_$type$_total which = FROM } 
	change_variable = { which = slaves which = SS_$type$_total }
	set_variable = { which = SS_$type$_total value = 0 }
	
	# Lose pops. Uses the xx lost done in the event, immediate phase
	FROM = {
		set_variable = { which = SS_slaves_taken which = SS_$type$_total }	# display in prov modifier
		set_variable = { which = SS_tlost_display which = SS_t_lost }
		set_variable = { which = SS_clost_display which = SS_c_lost }
		set_variable = { which = SS_ulost_display which = SS_u_lost }
		
		while = { limit = { check_variable = { SS_t_lost = 1 } } subtract_variable = { SS_t_lost = 1 } add_base_manpower = -1 }
		while = { limit = { check_variable = { SS_c_lost = 1 } } subtract_variable = { SS_c_lost = 1 } add_base_production = -1 }
		while = { limit = { check_variable = { SS_u_lost = 1 } } subtract_variable = { SS_u_lost = 1 } add_base_tax = -1 }
	
		# Province modifier effect
		add_province_modifier = { name = SS_enslavement_ongoing_here duration = $days$ }
		every_neighbor_province = {
			limit = { owned_by = FROM }
			add_province_modifier = { name = SS_enslavement_ongoing_here duration = $days$ }
		}
		every_neighbor_province = {
			limit = { owned_by = ROOT }
			add_province_modifier = { name = SS_enslavement_ongoing_there duration = $days$ }
		}
		
	}
	
	
	
}
enslave_delenda_effect = {
	# Define everyone (all but the 1 pop left). Recalculates amount lost, the event desc will be different
		
	FROM = {
		
		set_variable = { which = SS_t_lost which = SS_t_base } subtract_variable = { SS_t_lost = 1 }
		set_variable = { which = SS_c_lost which = SS_c_base } subtract_variable = { SS_c_lost = 1 }
		set_variable = { which = SS_u_lost which = SS_u_base } subtract_variable = { SS_u_lost = 1 }
		
		set_variable = { which = SS_tlost_display which = SS_t_lost }
		set_variable = { which = SS_clost_display which = SS_c_lost }
		set_variable = { which = SS_ulost_display which = SS_u_lost }
				
		set_variable = { which = SS_delenda_total which = SS_t_lost } 		change_variable = { which = SS_delenda_total which = SS_c_lost }
		change_variable = { which = SS_delenda_total which = SS_u_lost }	multiply_variable = { SS_delenda_total = 2 }			
			# yes, only 20%. Carthago 146 bc had 450k killed and 50k enslaved, so 20% is even high... 
		
		set_variable = { which = SS_slaves_taken which = SS_delenda_total }	# display in prov modifier
		
		while = { limit = { check_variable = { SS_t_lost = 0.9 } } subtract_variable = { SS_t_lost = 1 } add_base_manpower = -1 }
		while = { limit = { check_variable = { SS_c_lost = 0.9 } } subtract_variable = { SS_c_lost = 1 } add_base_production = -1 }
		while = { limit = { check_variable = { SS_u_lost = 0.9 } } subtract_variable = { SS_u_lost = 1 } add_base_tax = -1 }
	
		# Province modifier effect
		add_province_modifier = { name = SS_enslavement_ongoing_here duration = 180 }
		every_neighbor_province = {
			limit = { owned_by = FROM }
			add_province_modifier = { name = SS_enslavement_ongoing_here duration = 180 }
		}
		every_neighbor_province = {
			limit = { owned_by = ROOT }
			add_province_modifier = { name = SS_enslavement_ongoing_there duration = 180 }
		}
	}
	
	set_variable = { which = SS_delenda_total which = FROM }
	change_variable = { which = slaves which = SS_delenda_total }
	set_variable = { which = SS_delenda_total value = 0 }
	
}


collateral_damage_eff = {
	random_list = {
		10 = { trigger_switch = { on_trigger = has_building
			small_bath = { 	subtract_variable = { col_value = 150 } 	col_1_$hd$ = { val = 150 target = small_bath } }
			big_bath = { 	subtract_variable = { col_value = 300 } 	col_2_$hd$ = { val = 300 target = big_bath to_build = small_bath } }
		} }
		10 = { trigger_switch = { on_trigger = has_building
			mathematician_academy = { 	subtract_variable = { col_value = 1000 } 	col_1_$hd$ = { val = 1000 target = mathematician_academy } }
			philosophers_academy = { 	subtract_variable = { col_value = 1000 } 	col_1_$hd$ = { val = 1000 target = philosophers_academy } }
			military_academy = { 		subtract_variable = { col_value = 1000 } 	col_1_$hd$ = { val = 1000 target = military_academy } }
			great_library = { subtract_variable = { col_value = 1000 } 	col_2_$hd$ = { tval = 1000 arget = great_library to_build = library } }
				# He he, Library of Alexandria goes brrrr
			library = { subtract_variable = { col_value = 250 } 	col_1_$hd$ = { val = 250 target = library } }
		} }
		10 = { trigger_switch = { on_trigger = has_building
			embassy = { 			subtract_variable = { col_value = 375 } col_1_$hd$ = { val = 375 target = embassy } }
			diplomats_quarter = { 	subtract_variable = { col_value = 750 } 
									col_2_$hd$ = { val = 750 target = diplomats_quarter to_build = embassy } }
		} }
		10 = { trigger_switch = { on_trigger = has_building
			small_townhall = { 		subtract_variable = { col_value = 300 } col_1_$hd$ = { val = 300 target = small_townhall } }
			big_townhall = { 		subtract_variable = { col_value = 375 } 
									col_2_$hd$ = { val = 375 target = big_townhall to_build = small_townhall } }
			government_palace = { 	subtract_variable = { col_value = 600 } 
									col_2_$hd$ = { val = 600 target = government_palace to_build = big_townhall } }
			government_district = { subtract_variable = { col_value = 750 } 
									col_2_$hd$ = { val = 750 target = government_district to_build = government_palace } }
		} }
		10 = { trigger_switch = { on_trigger = has_building
			small_grain_depot = { 	subtract_variable = { col_value = 225 } col_1_$hd$ = { val = 225 target = small_grain_depot } }
			big_grain_depot = { 	subtract_variable = { col_value = 450 } 
									col_2_$hd$ = { val = 450 target = big_grain_depot to_build = small_grain_depot } }
		} }
		10 = { trigger_switch = { on_trigger = has_building
			small_market = { 	subtract_variable = { col_value = 150 } col_1_$hd$ = { val = 150 target = small_market } }
			medium_market = { 	subtract_variable = { col_value = 225 } col_2_$hd$ = { val = 225 target = medium_market to_build = small_market } }
			great_market = { 	subtract_variable = { col_value = 300 } col_2_$hd$ = { val = 300 target = great_market to_build = medium_market } }
		} }
		10 = { trigger_switch = { on_trigger = has_building
			small_harbor = { 	subtract_variable = { col_value = 150 } col_1_$hd$ = { val = 150 target = small_harbor } }
			big_harbor = { 		subtract_variable = { col_value = 300 } col_2_$hd$ = { val = 300 target = big_harbor to_build = small_harbor } }
			harbor_district = { subtract_variable = { col_value = 450 } col_2_$hd$ = { val = 450 target = harbor_district to_build = big_harbor } }
		} }
		10 = { trigger_switch = { on_trigger = has_building
			small_army_camp = { 			subtract_variable = { col_value = 150 } col_1_$hd$ = { val = 150 target = small_army_camp } }
			small_military_settlement = { 	subtract_variable = { col_value = 260 } 
											col_2_$hd$ = { val = 260 target = small_military_settlement to_build = small_army_camp } }
			big_military_settlement = { 	subtract_variable = { col_value = 375 } 
											col_2_$hd$ = { val = 375 target = big_military_settlement to_build = small_military_settlement } }
		} }
		10 = { 
			if = { limit = { has_building = small_conscription_center } 
			subtract_variable = { col_value = 187 } col_1_$hd$ = { val = 187 target = small_conscription_center }
		} }
		10 = { trigger_switch = { on_trigger = has_building
			small_water_irrigation = { 	subtract_variable = { col_value = 187 } col_1_$hd$ = { val = 187 target = small_water_irrigation } }
			big_water_irrigation = { 	subtract_variable = { col_value = 300 } 
										col_2_$hd$ = { val = 300 target = big_water_irrigation to_build = small_water_irrigation } }
			big_estate = { 				subtract_variable = { col_value = 412 } 
										col_2_$hd$ = { val = 412 target = big_estate to_build = big_water_irrigation } }
			
			craftsman = { 		subtract_variable = { col_value = 187 } col_1_$hd$ = { val = 187 target = craftsman } }
			small_workshop = { 	subtract_variable = { col_value = 300 } col_2_$hd$ = { val = 300 target = small_workshop to_build = craftsman } }
			artisan_district = { subtract_variable = { col_value = 412 } col_2_$hd$ = { val = 412 target = artisan_district to_build = small_workshop } }
			
			quarry = { 			subtract_variable = { col_value = 187 } col_1_$hd$ = { val = 187 target = quarry } }
			small_mine = { 		subtract_variable = { col_value = 300 } col_2_$hd$ = { val = 300 target = small_mine to_build = quarry } }
			big_mine = { 		subtract_variable = { col_value = 412 } col_2_$hd$ = { val = 412 target = big_mine to_build = small_mine } }
		} }
		10 = { trigger_switch = { on_trigger = has_building
			small_shipyard = { 	subtract_variable = { col_value = 187 } col_1_$hd$ = { val = 187 target = small_shipyard } }
			big_shipyard = { 	subtract_variable = { col_value = 375 } col_2_$hd$ = { val = 375 target = big_shipyard to_build = small_shipyard } }
		} }
		10 = { trigger_switch = { on_trigger = has_building
			military_monument = { subtract_variable = { col_value = 750 } col_1_$hd$ = { val = 750 target = military_monument } }
			naval_monument = { 	subtract_variable = { col_value = 750 } col_1_$hd$ = { val = 750 target = naval_monument } }
			imperial_palace = { subtract_variable = { col_value = 1500 } col_1_$hd$ = { val = 1500 target = imperial_palace } }
			palace_garden = { 	subtract_variable = { col_value = 1500 } col_1_$hd$ = { val = 1500 target = palace_garden } }
		} }
		10 = { trigger_switch = { on_trigger = has_building
			taxman = { 			subtract_variable = { col_value = 150 } col_1_$hd$ = { val = 150 target = taxman } }
			tax_collector = { 	subtract_variable = { col_value = 300 } col_2_$hd$ = { val = 300 target = tax_collector to_build = taxman } }
		} }
		10 = { trigger_switch = { on_trigger = has_building
			shrine = { 			subtract_variable = { col_value = 150 } col_1_$hd$ = { val = 150 target = shrine } }
			small_temple = { 	subtract_variable = { col_value = 225 } col_2_$hd$ = { val = 225 target = small_temple to_build = shrine } }
			great_temple = { 	subtract_variable = { col_value = 300 } col_2_$hd$ = { val = 300 target = great_temple to_build = small_temple } }
		} }
		10 = { trigger_switch = { on_trigger = has_building
			small_theater = { 	subtract_variable = { col_value = 225 } col_1_$hd$ = { val = 225 target = small_theater } }
			big_theater = { 	subtract_variable = { col_value = 375 } col_2_$hd$ = { val = 375 target = big_theater to_build = small_theater } }
			great_theater = { 	subtract_variable = { col_value = 525 } col_2_$hd$ = { val = 525 target = great_theater to_build = big_theater } }
			huge_theater = { 	subtract_variable = { col_value = 750 } col_2_$hd$ = { val = 750 target = huge_theater to_build = great_theater } }
		} }
		10 = { trigger_switch = { on_trigger = has_building
			gravel_road = { 	subtract_variable = { col_value = 187 } col_1_$hd$ = { val = 187 target = gravel_road } }
			paved_road = { 		subtract_variable = { col_value = 300 } col_2_$hd$ = { val = 300 target = paved_road to_build = gravel_road } }
			imperial_road = { 	subtract_variable = { col_value = 375 } col_2_$hd$ = { val = 375 target = imperial_road to_build = paved_road } }
		} }
		10 = { trigger_switch = { on_trigger = has_building 			# Last building, should be the last to survive.  
			herbalist = { 	subtract_variable = { col_value = 150 } col_1_$hd$ = { val = 150 target = herbalist } }
			medicus = { 	subtract_variable = { col_value = 225 } col_2_$hd$ = { val = 225 target = medicus to_build = herbalist } }
			hospital = { 	subtract_variable = { col_value = 300 } col_2_$hd$ = { val = 300 target = hospital to_build = medicus } }
		} }
		
		
		
	}
}
		
col_1_05 = { random = { chance = 5	remove_building = $target$ set_province_flag = $target$_lost change_variable = { SS_blds = $val$ } } }
col_2_05 = { random = { chance = 5	remove_building = $target$ add_building = $to_build$ set_province_flag = $target$_lost change_variable = { SS_blds = $val$ } } }
col_1_10 = { random = { chance = 10	remove_building = $target$ set_province_flag = $target$_lost change_variable = { SS_blds = $val$ } } }
col_2_10 = { random = { chance = 10	remove_building = $target$ add_building = $to_build$ set_province_flag = $target$_lost change_variable = { SS_blds = $val$ } } }
col_1_25 = { random = { chance = 25	remove_building = $target$ set_province_flag = $target$_lost change_variable = { SS_blds = $val$ } } }
col_2_25 = { random = { chance = 25	remove_building = $target$ add_building = $to_build$ set_province_flag = $target$_lost change_variable = { SS_blds = $val$ } } }
col_1_30 = { random = { chance = 30	remove_building = $target$ set_province_flag = $target$_lost change_variable = { SS_blds = $val$ } } }
col_2_30 = { random = { chance = 30	remove_building = $target$ add_building = $to_build$ set_province_flag = $target$_lost change_variable = { SS_blds = $val$ } } }
col_1_60 = { random = { chance = 60	remove_building = $target$ set_province_flag = $target$_lost change_variable = { SS_blds = $val$ } } }
col_2_60 = { random = { chance = 60	remove_building = $target$ add_building = $to_build$ set_province_flag = $target$_lost change_variable = { SS_blds = $val$ } } }
col_1_90 = { random = { chance = 90	remove_building = $target$ set_province_flag = $target$_lost change_variable = { SS_blds = $val$ } } }
col_2_90 = { random = { chance = 90	remove_building = $target$ add_building = $to_build$ set_province_flag = $target$_lost change_variable = { SS_blds = $val$ } } }

		
find_total_loot_value = {
	trigger_switch = {
		on_trigger = has_building
		mathematician_academy = { change_variable = { loot_value = 750 } }
		philosophers_academy = { change_variable = { loot_value = 750 } }
		military_academy = { 	change_variable = { loot_value = 750 } }
		great_library = { 		change_variable = { loot_value = 750 } }
		library = { 			change_variable = { loot_value = 262 } }
	}
	trigger_switch = {
		on_trigger = has_building
		small_bath = { 		change_variable = { loot_value = 150 } }
		big_bath = { 		change_variable = { loot_value = 300 } }
	}
	trigger_switch = {
		on_trigger = has_building
		embassy = { 			change_variable = { loot_value = 375 } }
		diplomats_quarter = { 	change_variable = { loot_value = 750 } }
	}
	trigger_switch = {
		on_trigger = has_building
		small_townhall = { 		change_variable = { loot_value = 300 } }
		big_townhall = { 		change_variable = { loot_value = 375 } }
		government_palace = { 	change_variable = { loot_value = 600 } }
		government_district = { change_variable = { loot_value = 750 } }
	}
	trigger_switch = {
		on_trigger = has_building
		small_grain_depot = { change_variable = { loot_value = 225 } }
		big_grain_depot = { change_variable = { loot_value = 450 } }
	}
	trigger_switch = {
		on_trigger = has_building
		small_harbor = { 	change_variable = { loot_value = 150 } }
		big_harbor = { 		change_variable = { loot_value = 300 } }
		harbor_district = { change_variable = { loot_value = 450 } }
	}
	trigger_switch = {
		on_trigger = has_building
		small_market = { 	change_variable = { loot_value = 150 } }
		medium_market = { 	change_variable = { loot_value = 225 } }
		great_market = { 	change_variable = { loot_value = 300 } }
	}
	trigger_switch = {
		on_trigger = has_building
		herbalist = { 	change_variable = { loot_value = 150 } }
		medicus = { 	change_variable = { loot_value = 225 } }
		hospital = { 	change_variable = { loot_value = 300 } }
	}
	trigger_switch = {
		on_trigger = has_building
		small_army_camp = { 			change_variable = { loot_value = 150 } }
		small_military_settlement = { 	change_variable = { loot_value = 260 } }
		big_military_settlement = { 	change_variable = { loot_value = 375 } }
	}
	if = { limit = { has_building = small_conscription_center } change_variable = { loot_value = 187 } }
	trigger_switch = {
		on_trigger = has_building
		small_water_irrigation = { 	change_variable = { loot_value = 187 } }
		big_water_irrigation = { 	change_variable = { loot_value = 300 } }
		big_estate = { 				change_variable = { loot_value = 412 } }
		
		craftsman = { change_variable = { loot_value = 187 } }
		small_workshop = { 	change_variable = { loot_value = 300 } }
		artisan_district = { change_variable = { loot_value = 412 } }
		
		quarry = { change_variable = { loot_value = 187 } }
		small_mine = { 		change_variable = { loot_value = 300 } }
		big_mine = { 		change_variable = { loot_value = 412 } }
	}
	trigger_switch = {
		on_trigger = has_building
		gravel_road = { 	change_variable = { loot_value = 187 } }
		paved_road = { 		change_variable = { loot_value = 300 } }
		imperial_road = { 	change_variable = { loot_value = 375 } }
	}
	trigger_switch = {
		on_trigger = has_building
		small_shipyard = { 	change_variable = { loot_value = 187 } }
		big_shipyard = { 	change_variable = { loot_value = 375 } }
	}
	trigger_switch = {
		on_trigger = has_building
		military_monument = { change_variable = { loot_value = 750 } }
		naval_monument = { 	change_variable = { loot_value = 750 } }
		imperial_palace = { change_variable = { loot_value = 1500 } }
		palace_garden = { 	change_variable = { loot_value = 1500 } }
	}
	trigger_switch = {
		on_trigger = has_building
		taxman = { 			change_variable = { loot_value = 150 } }
		tax_collector = { 	change_variable = { loot_value = 300 } }
	}
	trigger_switch = {
		on_trigger = has_building
		shrine = { 			change_variable = { loot_value = 150 } }
		small_temple = { 	change_variable = { loot_value = 225 } }
		great_temple = { 	change_variable = { loot_value = 300 } }
	}
	trigger_switch = {
		on_trigger = has_building
		small_theater = { 	change_variable = { loot_value = 225 } }
		big_theater = { 	change_variable = { loot_value = 375 } }
		great_theater = { 	change_variable = { loot_value = 525 } }
		huge_theater = { 	change_variable = { loot_value = 750 } }
	}
}
	